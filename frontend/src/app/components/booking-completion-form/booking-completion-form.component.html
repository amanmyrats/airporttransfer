<section class="reservation-detail-page">
    <div class="container">
      <!-- Left Section: Reservation Details -->
      <div class="reservation-details">
        <h2>Reservation Details</h2>
        <img [src]="'cars/vito.png'" [alt]="selectedCar?.name" class="car-image" />
        <p><strong>Car:</strong> {{ selectedCar?.name }}</p>
        <p><strong>From:</strong> {{ fromLocation }}</p>
        <p><strong>To:</strong> {{ toLocation }}</p>
        <p *ngIf="distance > 0"><strong>Distance:</strong> {{ distance }} km</p>
        <p><strong>Price:</strong> {{ price! }} {{ currency?.sign }}</p>
      </div>
  
      <!-- Right Section: Form -->
      <div class="reservation-form">
        <h2>Complete Your Reservation</h2>
        <form [formGroup]="bookingService.bookingCompletionForm" (ngSubmit)="onSubmit()">
          <!-- Travel and Flight Info -->
          <div class="form-group">
            <h3>Travel and Flight Information</h3>
            <div class="form-row">
              <div class="form-item">
                <label for="transfer_date">Transfer Date</label>
                <input type="date" id="transfer_date" formControlName="transfer_date" required />
                <p-message *ngIf="hasSubmitted && bookingService.bookingCompletionForm.get('transfer_date')?.invalid" 
                severity="error" variant="simple" size="small">Transfer date is required</p-message>
              </div>
              <div class="form-item">
                <label for="transfer_time">Transfer Time</label>
                <input type="time" id="transfer_time" formControlName="transfer_time" required />
                <p-message *ngIf="hasSubmitted && bookingService.bookingCompletionForm.get('transfer_time')?.invalid" 
                severity="error" variant="simple" size="small">Transfer Time is required</p-message>
              </div>
              <div class="form-item">
                <label for="flight_number">Flight Number</label>
                <input type="text" id="flight_number" formControlName="flight_number" placeholder="e.g., TK1234" />
              </div>
            </div>

            <div class="toggle-switch-container">
              <span>Want Return Transfer?</span>
              <p-toggleswitch formControlName="is_round_trip"></p-toggleswitch>
            </div>

            <div *ngIf="bookingService.bookingCompletionForm.get('is_round_trip')?.value">
              <div class="form-row">
                <div class="form-item">
                  <label for="return_transfer_date">Return Date</label>
                  <input type="date" id="return_transfer_date" formControlName="return_transfer_date" />
                </div>
                <div class="form-item">
                  <label for="return_transfer_time">Return Time</label>
                  <input type="time" id="return_transfer_time" formControlName="return_transfer_time" />
                </div>
              </div>
            </div>
          </div>
  
          <!-- Personal Info -->
          <div class="form-group">
            <h3>Personal Information</h3>
            <div class="form-row">
              <div class="form-item">
                <label for="passenger_name">Name and Surname</label>
                <input type="text" id="passenger_name" formControlName="passenger_name" placeholder="Full Name" required />
                <p-message *ngIf="hasSubmitted && bookingService.bookingCompletionForm.get('passenger_name')?.invalid" 
                severity="error" variant="simple" size="small">Full Name is required</p-message>
              </div>
              <div class="form-item">
                <label for="passenger_email">Email</label>
                <input type="email" id="passenger_email" formControlName="passenger_email" placeholder="Email Address" />
              </div>
              <div class="form-item">
                <label for="passenger_phone">Phone</label>
                <input type="tel" id="passenger_phone" formControlName="passenger_phone" placeholder="Primary Phone" required />
                <p-message *ngIf="hasSubmitted && bookingService.bookingCompletionForm.get('passenger_phone')?.invalid" 
                severity="error" variant="simple" size="small">Mobile Phone is required</p-message>
              </div>
              <div class="form-item">
                <label for="passenger_additional_phone">Additional Phone</label>
                <input type="tel" id="passenger_additional_phone" formControlName="passenger_additional_phone" placeholder="Optional Phone" />
              </div>
              <div class="form-item">
                <label for="passenger_count">Passenger Count:</label>
                <p-inputnumber formControlName="passenger_count" 
                    [showButtons]="true" 
                    buttonLayout="horizontal" 
                    spinnerMode="horizontal" 
                    [min]="0" [max]="20"
                    [inputStyle]="{ width: '5rem' }">
                  <ng-template #incrementbuttonicon>
                    <span class="pi pi-plus"></span>
                  </ng-template>
                  <ng-template #decrementbuttonicon>
                    <span class="pi pi-minus"></span>
                  </ng-template>
                </p-inputnumber>
              </div>
              <div class="form-item">
                <label for="passenger_count_child">Child Count (1-7 years):</label>
                <p-inputnumber 
                  formControlName="passenger_count_child" 
                  [showButtons]="true" 
                  buttonLayout="horizontal" 
                  spinnerMode="horizontal" 
                  [min]="0" [max]="9"
                  [inputStyle]="{ width: '5rem' }">
                  <ng-template #incrementbuttonicon>
                    <span class="pi pi-plus"></span>
                  </ng-template>
                  <ng-template #decrementbuttonicon>
                    <span class="pi pi-minus"></span>
                  </ng-template>
                </p-inputnumber>
              </div>
            </div>
          </div>
  

          <!-- Extra Services -->
          <div class="form-group">
            <h3>Extra Services</h3>
            
            
            <div class="toggle-switch-container">
              <span>Need Greeter Sign?</span>
              <p-toggleswitch formControlName="need_greet_sign"></p-toggleswitch>
            </div>

            <div class="toggle-switch-container">
              <span>Need Child Seat?</span>
              <p-toggleswitch formControlName="need_child_seat"></p-toggleswitch>
              <p-inputnumber 
                *ngIf="this.bookingService.bookingCompletionForm.value.need_child_seat" 
                formControlName="child_seat_count" 
                [showButtons]="true" 
                buttonLayout="horizontal" 
                spinnerMode="horizontal" 
                [min]="0" [max]="9"
                [inputStyle]="{ width: '3rem' }">
                <ng-template #incrementbuttonicon>
                  <span class="pi pi-plus"></span>
                </ng-template>
                <ng-template #decrementbuttonicon>
                  <span class="pi pi-minus"></span>
                </ng-template>
              </p-inputnumber>
            </div>
            

            <div class="form-item">
              <label for="note">Note</label>
              <textarea id="note" formControlName="note" rows="3" placeholder="Write any additional details..."></textarea>
            </div>
          </div>
          
          <!-- Payment Information -->
          <div class="form-group">
            <h3>Payment </h3>
            <div class="payment-info">
              <div class="total-price"><strong>{{ price! }} {{ currency?.sign }}</strong></div>
              <p>
                Pay cash to the driver after your trip. No payment is required until you're fully satisfied.
              </p>
            </div>
            
          </div>

          <!-- Complete Reservation -->
          <div class="form-actions">
            <p-message *ngIf="hasSubmitted && bookingService.bookingCompletionForm.invalid" 
            severity="info" variant="simple" size="small">Please fill required fields</p-message>
            <button pButton [loading]="isSaving" type="submit" class="btn-complete">Complete Reservation</button>
            <button [hidden]="stepFromUrl == 3" type="button" class="btn-back" (click)="goToPreviousStep()">Back</button>
          </div>
        </form>
      </div>
    </div>
  </section>
  