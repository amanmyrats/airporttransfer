<section class="car-selection">
  <header class="car-selection__header">
    <div class="car-selection__heading">
      <span class="car-selection__badge">{{ translations.cars[langInput.code] }}</span>
      <h1>{{ translations.bookYourRide ? translations.bookYourRide[langInput.code] : translations.cars[langInput.code] }}</h1>
    </div>
    <div
      class="car-selection__route"
      *ngIf="bookingService.bookingInitialForm.value.pickup_full || bookingService.bookingInitialForm.value.dest_full"
    >
      <div class="summary-route" *ngIf="bookingService.bookingInitialForm.value.pickup_full as pickupFull">
        <div class="route-chip">
          <span class="route-icon" aria-hidden="true">üìç</span>
          <span class="route-text">
            <span class="route-text__label">{{ translations.from[langInput.code] }}</span>
            <span class="route-text__primary">
              {{
                getPrimaryLocation(pickupFull)
                  || pickupFull
              }}
            </span>
            <span
              class="route-text__secondary"
              *ngIf="getSecondaryLocation(pickupFull)"
            >
              {{ getSecondaryLocation(pickupFull) }}
            </span>
          </span>
        </div>
      </div>

      <div class="summary-route" *ngIf="bookingService.bookingInitialForm.value.dest_full as destFull">
        <div class="route-chip route-chip--destination">
          <span class="route-icon" aria-hidden="true">üèÅ</span>
          <span class="route-text">
            <span class="route-text__label route-text__label--destination">{{ translations.to[langInput.code] }}</span>
            <span class="route-text__primary">
              {{
                getPrimaryLocation(destFull)
                  || destFull
              }}
            </span>
            <span
              class="route-text__secondary"
              *ngIf="getSecondaryLocation(destFull)"
            >
              {{ getSecondaryLocation(destFull) }}
            </span>
          </span>
        </div>
      </div>
    </div>
    <div
      class="car-selection__metrics"
      *ngIf="bookingService.bookingCarTypeSelectionForm.value.distance || bookingService.bookingCarTypeSelectionForm.value.driving_duration"
    >
      <div class="metric" *ngIf="bookingService.bookingCarTypeSelectionForm.value.distance">
        <span class="metric-icon" aria-hidden="true">üõ£Ô∏è</span>
        <strong class="metric-value">
          {{ bookingService.bookingCarTypeSelectionForm.value.distance | number: '1.0-0' }} km
        </strong>
      </div>
      <div class="metric" *ngIf="bookingService.bookingCarTypeSelectionForm.value.driving_duration">
        <span class="metric-icon" aria-hidden="true">‚è±Ô∏è</span>
        <strong class="metric-value">
          {{
            bookingService.bookingCarTypeSelectionForm.value.driving_duration
              | durationFormat: langInput?.code
          }}
        </strong>
      </div>
    </div>
  </header>

  <div class="car-selection__notices">
    <div class="car-selection__notice" *ngIf="!isValidDistance()">
      <h2>{{ translations.contact[langInput.code] }}</h2>
      <p>{{ translations.invalidDistanceMessage[langInput.code] }}</p>
      <ul class="contact-links">
        <li>
          <span aria-hidden="true">üí¨</span>
          <a [href]="socialIcons.whatsapp.url" target="_blank" rel="noopener">WhatsApp {{ socialIcons.phone.formatted }}</a>
        </li>
        <li>
          <span aria-hidden="true">üì®</span>
          <a [href]="socialIcons.telegram.url" target="_blank" rel="noopener">Telegram &#64;{{ socialIcons.telegram.username }}</a>
        </li>
      </ul>
    </div>

    <div class="car-selection__notice car-selection__notice--highlight" *ngIf="isLongDistance()">
      <h2>{{ translations.specialPrice[langInput.code] }}</h2>
      <p>{{ translations.longDistanceMessage[langInput.code] }}</p>
      <ul class="contact-links">
        <li>
          <span aria-hidden="true">üí¨</span>
          <a [href]="socialIcons.whatsapp.url" target="_blank" rel="noopener">WhatsApp {{ socialIcons.phone.formatted }}</a>
        </li>
        <li>
          <span aria-hidden="true">üì®</span>
          <a [href]="socialIcons.telegram.url" target="_blank" rel="noopener">Telegram &#64;{{ socialIcons.telegram.username }}</a>
        </li>
      </ul>
    </div>
  </div>

  <div class="car-grid" *ngIf="isValidDistance() && !isLongDistance()">
    <article class="car-card" *ngFor="let carType of calculatedPrices()">
      <figure class="car-card__media">
        <img
          class="car-card__image"
          [src]="'images/cartypes/' + carType.image.name[languageService.currentLang().code]"
          [alt]="carType.image.alt[languageService.currentLang().code]"
        />
        <figcaption class="car-card__badge">{{ translations.availableCar?.[langInput.code] || 'Available' }}</figcaption>
        <div class="car-card__overlay">
          <h2 class="car-card__overlay-title">{{ carType.name }}</h2>
          <span class="car-card__overlay-subtitle">{{ translations.orEquivalent?.[langInput.code] || 'or equivalent' }}</span>
        </div>
      </figure>
      <div class="car-card__content">
        <section class="car-card__body">
          <div class="car-card__metrics" *ngIf="!carType.specialPrice">
            <div class="car-card__metric car-card__metric--capacity">
              <span class="car-card__metric-icon" aria-hidden="true">üë•</span>
              <div class="car-card__metric-text">
                <strong class="car-card__metric-value">{{ carType.pax }} {{ translations.passengers?.[langInput.code] || 'Passengers' }}</strong>
              </div>
            </div>
            <div class="car-card__metric car-card__metric--price">
              <div class="car-card__metric-text">
                <strong class="car-card__metric-value">{{ carType.price }} {{ currencyService.currentCurrency().sign }}</strong>
              </div>
            </div>
          </div>

          <div class="car-card__cta-row" *ngIf="!carType.specialPrice; else specialContact">
            <button
              type="button"
              class="car-card__cta"
              (click)="onCarTypeSelection(
                carType,
                carType.price,
                currencyService.currentCurrency().code!,
                bookingService.bookingCarTypeSelectionForm.value.distance
              )"
            >
              {{ translations.selectThisCar?.[langInput.code] || 'Select This Car' }}
            </button>
          </div>
        </section>

        <ng-template #specialContact>
          <div class="car-card__special">
            <span class="car-card__special-label">{{ translations.specialPrice[langInput.code] }}</span>
            <ul class="contact-links contact-links--inline">
              <li>
                <span aria-hidden="true">üí¨</span>
                <a [href]="socialIcons.whatsapp.url" target="_blank" rel="noopener">WhatsApp {{ socialIcons.phone.formatted }}</a>
              </li>
              <li>
                <span aria-hidden="true">üì®</span>
                <a [href]="socialIcons.telegram.url" target="_blank" rel="noopener">Telegram &#64;{{ socialIcons.telegram.username }}</a>
              </li>
              <li>
                <span aria-hidden="true">‚úâÔ∏è</span>
                <a [href]="'mailto:' + socialIcons.email.info">{{ socialIcons.email.info }}</a>
              </li>
            </ul>
          </div>
        </ng-template>
      </div>
    </article>
  </div>
</section>

<section class="fixed-price-section">
  <h3>{{ translations.fixedPrices[langInput.code] }}</h3>
  <app-price-list [langInput]="langInput"></app-price-list>
</section>
