<div class="form-wrapper">
  <h3 class="title">{{ category?.id ? 'Edit Category' : 'Create Category' }}</h3>

  <form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">
    <input type="hidden" formControlName="id" />

    <div class="form-field">
      <label for="name">Category Name <span class="required">*</span></label>
      <input id="name" type="text" pInputText formControlName="name" placeholder="e.g. Istanbul Airport Transfers" />
      <small *ngIf="f['name'].touched && f['name'].invalid" class="error">Name is required.</small>
    </div>

    <div class="form-field">
      <label for="slug">Slug</label>
      <input id="slug" type="text" pInputText formControlName="slug" placeholder="e.g. istanbul-airport-transfers" />
      <small>Leave empty to auto-generate from name (backend guarantees uniqueness).</small>
      <small *ngIf="f['slug'].touched && f['slug'].invalid" class="error">Slug is invalid.</small>
      <p-message *ngIf="!f['slug'].value" severity="info" text="Empty is okay — we will generate it."></p-message>
    </div>

    <div class="form-actions">
      <button pButton type="submit" label="Save" icon="pi pi-check"></button>
    </div>
  </form>

  <section *ngIf="category?.id" class="translations">
    <header class="translations__header">
      <h4>Translations</h4>
      <div class="lang-actions">
        <button
          *ngFor="let l of languages"
          pButton
          type="button"
          class="p-button-sm p-button-text"
          [label]="l.name"
          (click)="openTranslationForm(l.code, getTranslationForLang(l.code))">
        </button>
      </div>
    </header>

    <p-table [value]="translations" [tableStyle]="{ 'min-width': '100%' }" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Language</th>
          <th>Name</th>
          <th>Slug</th>
          <th style="width: 120px;">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-tx>
        <tr>
          <td>{{ tx.language?.toUpperCase() }}</td>
          <td>{{ tx.name || '—' }}</td>
          <td>{{ tx.slug || '—' }}</td>
          <td>
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm" type="button" (click)="openTranslationForm(tx.language, tx)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </section>

  <p-toast [life]="8000"></p-toast>
</div>
