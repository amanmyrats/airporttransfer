<app-super-header></app-super-header>
<app-navbar></app-navbar>

<main class="auth-page" aria-labelledby="register-title">
  <section class="auth-card">
    <h1 id="register-title">{{ copy.title }}</h1>
    <p class="auth-subtitle">{{ copy.subtitle }}</p>

    <section
      *ngIf="serverGeneralErrors().length"
      class="alert alert--error"
      role="alert"
      aria-live="polite"
    >
      <ul class="alert__list">
        <li *ngFor="let message of serverGeneralErrors()">{{ message }}</li>
      </ul>
    </section>

    <ng-container *ngIf="!success(); else successTpl">
      <form [formGroup]="form" (ngSubmit)="submit()" novalidate class="form">
        <div class="form-field" [class.form-field--invalid]="controlInvalid('email')">
          <label for="email">{{ copy.labels.email }}</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            autocomplete="email"
            required
            [attr.aria-invalid]="controlInvalid('email')"
            [attr.aria-describedby]="controlInvalid('email') ? 'email-errors' : null"
            [class.input-invalid]="controlInvalid('email')"
          />
          <ng-container *ngIf="fieldErrors('email') as emailErrors">
            <ul *ngIf="emailErrors.length" class="form-error-list" id="email-errors">
              <li *ngFor="let message of emailErrors">{{ message }}</li>
            </ul>
          </ng-container>
        </div>

        <div class="form-field" [class.form-field--invalid]="controlInvalid('password')">
          <label for="password">{{ copy.labels.password }}</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            autocomplete="new-password"
            required
            [attr.aria-invalid]="controlInvalid('password')"
            [attr.aria-describedby]="controlInvalid('password') ? 'password-errors' : null"
            [class.input-invalid]="controlInvalid('password')"
          />
          <ng-container *ngIf="fieldErrors('password') as passwordErrors">
            <ul *ngIf="passwordErrors.length" class="form-error-list" id="password-errors">
              <li *ngFor="let message of passwordErrors">{{ message }}</li>
            </ul>
          </ng-container>
        </div>

        <div class="form-field" [class.form-field--invalid]="controlInvalid('first_name')">
          <label for="first_name">{{ copy.labels.firstName }}</label>
          <input
            id="first_name"
            formControlName="first_name"
            autocomplete="given-name"
            [attr.aria-invalid]="controlInvalid('first_name')"
            [attr.aria-describedby]="controlInvalid('first_name') ? 'first-name-errors' : null"
            [class.input-invalid]="controlInvalid('first_name')"
          />
          <ng-container *ngIf="fieldErrors('first_name') as firstNameErrors">
            <ul *ngIf="firstNameErrors.length" class="form-error-list" id="first-name-errors">
              <li *ngFor="let message of firstNameErrors">{{ message }}</li>
            </ul>
          </ng-container>
        </div>

        <div class="form-field" [class.form-field--invalid]="controlInvalid('last_name')">
          <label for="last_name">{{ copy.labels.lastName }}</label>
          <input
            id="last_name"
            formControlName="last_name"
            autocomplete="family-name"
            [attr.aria-invalid]="controlInvalid('last_name')"
            [attr.aria-describedby]="controlInvalid('last_name') ? 'last-name-errors' : null"
            [class.input-invalid]="controlInvalid('last_name')"
          />
          <ng-container *ngIf="fieldErrors('last_name') as lastNameErrors">
            <ul *ngIf="lastNameErrors.length" class="form-error-list" id="last-name-errors">
              <li *ngFor="let message of lastNameErrors">{{ message }}</li>
            </ul>
          </ng-container>
        </div>

        <div class="form-field" [class.form-field--invalid]="controlInvalid('preferred_language')">
          <label for="preferred_language">{{ copy.labels.preferredLanguage }}</label>
          <select
            id="preferred_language"
            formControlName="preferred_language"
            [attr.aria-invalid]="controlInvalid('preferred_language')"
            [attr.aria-describedby]="controlInvalid('preferred_language') ? 'preferred-language-errors' : null"
            [class.input-invalid]="controlInvalid('preferred_language')"
          >
            <option *ngFor="let option of languages" [value]="option.code">{{ option.label }}</option>
          </select>
          <ng-container *ngIf="fieldErrors('preferred_language') as preferredLanguageErrors">
            <ul *ngIf="preferredLanguageErrors.length" class="form-error-list" id="preferred-language-errors">
              <li *ngFor="let message of preferredLanguageErrors">{{ message }}</li>
            </ul>
          </ng-container>
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="loading()">{{ loading() ? copy.submitBusy : copy.submitIdle }}</button>
      </form>

      <footer class="auth-footer">
        <p>{{ copy.footerPrompt }} <button type="button" class="link-button" (click)="navigateToLogin()">{{ copy.footerLink }}</button></p>
      </footer>
    </ng-container>

    <ng-template #successTpl>
      <div class="success-state">
        <h2>{{ copy.successTitle }}</h2>
        <p>{{ copy.successMessage }}</p>
        <button type="button" class="btn btn-primary" (click)="navigateToLogin()">{{ copy.successBack }}</button>
      </div>
    </ng-template>
  </section>
</main>

<app-footer></app-footer>
