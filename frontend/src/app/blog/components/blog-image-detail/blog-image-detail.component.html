@for (blogImage of (section.images ?? []); track blogImage.id) {
  <figure class="blog-image-item" [style.background-color]="blogImage.dominant_color || '#f4f4f4'">
    <div class="image-translation-row">
      <!-- IMAGE SIDE -->
      <div class="image-side">
        <div class="image-side__actions">
          <div *ngIf="!isUploadingImage; else spinnerTpl">
            <p-fileUpload
              mode="basic"
              name="image"
              accept="image/*"
              auto
              chooseLabel="Upload Image"
              customUpload
              (uploadHandler)="onImageUpload($event, blogImage.id!)">
            </p-fileUpload>
          </div>

          <ng-template #spinnerTpl>
            <p-progressSpinner
              strokeWidth="10"
              [style]="{ width: '20px', height: '20px' }"
              styleClass="upload-spinner" />
          </ng-template>

          <div *ngIf="!isRemovingImage; else spinnerTpl">
            <button
              *ngIf="blogImage.image"
              pButton
              label="Remove"
              class="p-button-danger p-button-sm mt-2"
              (click)="deleteImage(blogImage.id!)">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor"
                   class="bi bi-trash" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5.5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6zm3-.5a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5z" />
                <path fill-rule="evenodd"
                      d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
              </svg>
            </button>

          </div>
        </div>

        <img
          *ngIf="blogImage.image"
          class="image-side__preview"
          [src]="blogImage.image"
          [alt]="blogImage.seo?.alt"
          [title]="blogImage.seo?.title"
          [attr.aria-label]="blogImage.seo?.aria_label"
          [attr.type]="blogImage.mime_type || null"
          loading="lazy"
          decoding="async" />
      </div>

      <!-- TRANSLATION SIDE (only selected language) -->
      <div class="translation-side">
        <ng-container *ngIf="getSelectedTranslation(blogImage) as translation; else noSelectedTranslation">
          <section class="translation-card" [attr.lang]="translation.language">
            <header class="translation-card__header">
              <span class="lang-chip">{{ translation.language?.toUpperCase() }}</span>

              <p-button
                class="edit-btn"
                [label]="'Edit'"
                [rounded]="true"
                outlined="true"
                size="small"
                (click)="openBlogImageTranslationForm(blogImage.id!, translation)">
                <ng-template pTemplate="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor"
                       class="bi bi-pencil" viewBox="0 0 16 16">
                    <path d="M12.146.854a.5.5 0 0 1 .708 0l2.292 2.292a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zM10.5 3.207 2 11.707V14h2.293l8.5-8.5-2.293-2.293z"/>
                  </svg>
                </ng-template>
              </p-button>
            </header>

            <div class="translation-card__body">
              <div class="caption" *ngIf="translation.caption; else noCaption">
                {{ translation.caption }}
              </div>
              <ng-template #noCaption>
                <div class="caption caption--muted">No caption</div>
              </ng-template>

              <dl class="kv">
                <div class="kv__row">
                  <dt>Alt</dt>
                  <dd [class.muted]="!translation.alt_text">{{ translation.alt_text || '—' }}</dd>
                </div>
                <div class="kv__row">
                  <dt>Title</dt>
                  <dd [class.muted]="!translation.title_text">{{ translation.title_text || '—' }}</dd>
                </div>
                <div class="kv__row">
                  <dt>ARIA</dt>
                  <dd [class.muted]="!translation.aria_label">{{ translation.aria_label || '—' }}</dd>
                </div>
                <div class="kv__row" *ngIf="translation.file_name_override">
                  <dt>Filename</dt>
                  <dd>{{ translation.file_name_override }}</dd>
                </div>
                <div class="kv__row" *ngIf="translation.long_description">
                  <dt>Long description</dt>
                  <dd>{{ translation.long_description }}</dd>
                </div>
              </dl>
            </div>
          </section>
        </ng-container>

        <ng-template #noSelectedTranslation>
          <section class="translation-empty">
            <p class="empty-text">
              No translation for <strong>{{ language.toUpperCase() }}</strong>.
            </p>
            <p-button
              class="add-btn"
              [label]="'Add Translation'"
              [rounded]="true"
              outlined="true"
              size="small"
              (click)="openBlogImageTranslationForm(blogImage.id!, null)">
              <ng-template pTemplate="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor"
                     class="bi bi-plus" viewBox="0 0 16 16">
                  <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                </svg>
              </ng-template>
            </p-button>
          </section>
        </ng-template>
      </div>
    </div>
  </figure>
} @empty {
  No images available

  <p-button
    class="p-button-primary"
    [label]="'Add New Image'"
    [rounded]="true"
    size="small"
    (click)="addNewEmptyBlogImage(section.id!)">
    <ng-template pTemplate="icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
           class="bi bi-plus" viewBox="0 0 16 16">
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
      </svg>
    </ng-template>
  </p-button>
}

@if (section.section_type === 'gallery' && (section.images?.length ?? 0) > 0) {
  <div class="gallery-add-more">
    You can add more images to the gallery:
    <p-button
      class="p-button-primary"
      [label]="'Add New Image'"
      [rounded]="true"
      size="small"
      (click)="addNewEmptyBlogImage(section.id!)">
      <ng-template pTemplate="icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
             class="bi bi-plus" viewBox="0 0 16 16">
          <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
        </svg>
      </ng-template>
    </p-button>
  </div>
}
