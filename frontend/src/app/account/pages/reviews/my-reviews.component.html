<section class="reviews">
  <header class="reviews__header">
    <div>
      <h1>My Reviews</h1>
      <p class="reviews__subhead">Track the status of your ride feedback.</p>
    </div>
    <button
      pButton
      type="button"
      label="Refresh"
      icon="pi pi-refresh"
      class="p-button-text"
      (click)="refresh()"
      [disabled]="loading()"
    ></button>
  </header>

  <p class="reviews__hint">Reviews become editable for 15 minutes after submission.</p>

  <p *ngIf="!loading() && reviews().length === 0" class="reviews__empty">
    You have not submitted any reviews yet. View a completed reservation to write your first review.
  </p>

  <p-card *ngFor="let review of reviews(); trackBy: trackByReviewId" class="reviews__card">
    <ng-template pTemplate="header">
      <ng-container *ngIf="statusMeta(review.status) as status">
        <div class="reviews__card-header">
          <span
            class="reviews__status"
            [ngClass]="{ 'reviews__status--live': status.variant === 'live' }"
          >
            {{ status.label }}
          </span>
          <span class="reviews__rating">{{ review.rating }} / 5</span>
        </div>
        <div class="reviews__reservation">{{ reviewReservationLabel(review) }}</div>
      </ng-container>
    </ng-template>

    <p class="reviews__title" *ngIf="review.title; else untitled">{{ review.title }}</p>
    <ng-template #untitled>
      <p class="reviews__title reviews__title--muted">No title provided</p>
    </ng-template>

    <p class="reviews__comment" *ngIf="review.comment; else noComment">{{ review.comment }}</p>
    <ng-template #noComment>
      <p class="reviews__comment reviews__comment--muted">No comment shared.</p>
    </ng-template>

    <p class="reviews__status-note" *ngIf="statusMeta(review.status).note">
      {{ statusMeta(review.status).note }}
    </p>

    <div class="reviews__footer">
      <span class="reviews__timestamp">Created {{ review.created_at | date: 'medium' }}</span>
      <a
        pButton
        type="button"
        class="p-button-sm"
        [routerLink]="detailLink(review)"
        label="View"
      ></a>
    </div>
  </p-card>
</section>
